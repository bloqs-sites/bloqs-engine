!function(){"use strict";function e(e){const t=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return t?decodeURIComponent(t[1]):null}function t(e,t,n){for(var r=0,o=t.length,s=e.length;r<o&&!(n+r>=s||e[n+r]!=t[r]);++r);return r===o}function n(){const e=document.forms.namedItem("bloqs-create");if(null===e)return;const n=e.keywords;if(!(n instanceof HTMLTextAreaElement))return;n.addEventListener("input",(()=>{const e=function(e,n){for(var r=0,o=e.length,s=n.length;r<o&&t(e,n,r);)r+=n.length;for(;o>r&&t(e,n,o-s);)o-=n.length;return r>0||o<e.length?e.substring(r,o):e}(n.value,";").split(";"),r=[],o=new RegExp(/^\s*$/);for(const t of e){const e=r.length;t.match(o)?(void 0===r[e]&&(r[e]=""),r[e]+=t.length?t:";"):(r[e]?.length&&(r[e+1]=""),void 0===r[e]&&(r[e]=""),r[e]+=t)}console.log(e,r)}))}var r=function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)};function o(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}u((r=r.apply(e,t||[])).next())}))}function s(e,t){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}}"function"==typeof SuppressedError&&SuppressedError;var i=function(){function e(e,t){void 0===e&&(e={response:null,responseText:null,responseXML:null}),void 0===t&&(t={});var n=this;Object.defineProperty(this,"response",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"responseText",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"responseXML",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"statusText",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"ok",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"headers",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:function(){return o(n,void 0,void 0,(function(){var e,t,n,r;return s(this,(function(o){switch(o.label){case 0:return null===(t=this.responseText)||void 0===t?[3,1]:(e=t,[3,3]);case 1:return[4,null===(n=this.response)||void 0===n?void 0:n.text()];case 2:e=o.sent(),o.label=3;case 3:return[2,null!==(r=e)&&void 0!==r?r:null]}}))}))}}),Object.defineProperty(this,"json",{enumerable:!0,configurable:!0,writable:!0,value:function(){return o(n,void 0,void 0,(function(){var e,t,n;return s(this,(function(r){switch(r.label){case 0:return t=(e=JSON).parse,[4,this.text()];case 1:return[2,t.apply(e,[null!==(n=r.sent())&&void 0!==n?n:""])]}}))}))}}),Object.defineProperty(this,"formData",{enumerable:!0,configurable:!0,writable:!0,value:function(){return o(n,void 0,void 0,(function(){return s(this,(function(e){return[2]}))}))}}),Object.defineProperty(this,"blob",{enumerable:!0,configurable:!0,writable:!0,value:function(){return o(n,void 0,void 0,(function(){return s(this,(function(e){return[2,this.response instanceof Blob?this.response:null]}))}))}}),Object.defineProperty(this,"arrayBuffer",{enumerable:!0,configurable:!0,writable:!0,value:function(){return o(n,void 0,void 0,(function(){var e,t;return s(this,(function(n){switch(n.label){case 0:return this.response instanceof ArrayBuffer?(e=this.response,[3,5]):[3,1];case 1:return this.response instanceof Blob?[4,this.response.arrayBuffer()]:[3,3];case 2:return t=n.sent(),[3,4];case 3:t=null,n.label=4;case 4:e=t,n.label=5;case 5:return[2,e]}}))}))}}),Object.defineProperty(this,"document",{enumerable:!0,configurable:!0,writable:!0,value:function(){return o(n,void 0,void 0,(function(){return s(this,(function(e){return[2,this.responseXML]}))}))}}),Object.defineProperty(this,"readableStrem",{enumerable:!0,configurable:!0,writable:!0,value:function(){return o(n,void 0,void 0,(function(){return s(this,(function(e){return[2,this.response instanceof ReadableStream?this.response:this.response instanceof Blob?this.response.stream():null]}))}))}}),this.response=e.response,this.responseText=e.responseText,this.responseXML=e.responseXML,t.status&&this.setStatus(t.status),t.statusText&&(this.statusText=t.statusText),t.headers&&(this.headers=t.headers)}return Object.defineProperty(e.prototype,"setStatus",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.status=e,Math.ceil(e/100)&&(this.ok=!0)}}),e}();var a={method:"GET",headers:{},body:null,mode:"cors",credentials:!1,referrer:"",referrerPolicy:""};function u(e,t){var n=function(e){void 0===e&&(e={});var t=Object.assign(a,e);return t.headers=r(r({},a.headers),e.headers),t}(t);return new Promise((function(t){var r=new XMLHttpRequest;r.onreadystatechange=function(){var e,o;switch(this.readyState){case XMLHttpRequest.UNSENT:break;case XMLHttpRequest.OPENED:for(var s in null!==(e=(o=n.headers)["Content-Type"])&&void 0!==e||(o["Content-Type"]=function(e){if(e instanceof XMLDocument)return"text/xml";if(e instanceof Document)return"text/html";if(e instanceof FormData)return"multipart/form-data";if(e instanceof URLSearchParams)return"x-www-form-urlencoded";return"text/plain;charset=UTF-8"}(n.body)),this.setRequestHeader("Content-Type",n.headers["Content-Type"]),n.headers){var a=n.headers[s];"string"==typeof a&&r.setRequestHeader(s.trim(),a.trim())}this.send(n.body);break;case XMLHttpRequest.HEADERS_RECEIVED:case XMLHttpRequest.LOADING:break;case XMLHttpRequest.DONE:200==this.status&&t(new i({response:this.response,responseText:["","text"].includes(this.responseType)?this.responseText:null,responseXML:["","document"].includes(this.responseType)?this.responseXML:null},{status:this.status,statusText:this.statusText,headers:Object.fromEntries(this.getAllResponseHeaders().split(/\r\n/).slice(0,-1).map((function(e){return e.split(/:/).map((function(e){return e.trim()}))})))}))}},r.responseType="blob",r.withCredentials=n.credentials,r.open(n.method,e,!0),function(e){e.onload=function(){200!=this.status&&console.error("Error ".concat(this.status,": ").concat(this.statusText))},e.onerror=function(){throw new Error("Network Error. Request failed")},e.onprogress=function(e){}}(r)}))}const c="https://bloqs.torres-dev.workers.dev/sch",l="bloq-instance";async function d(e){const t=e.target;if(t.name!==l||"url"!==t.type)return;const{form:n}=t;if(null===n)return;if(!n.reportValidity())return void t.focus();try{new URL(t.value)}catch{return}let r,o;try{r=await u(t.value)}catch{return}if(r.ok){try{o=await r.json()}catch{return}"object"==typeof o&&o.$scheme===c&&"string"==typeof o.name&&console.log(o.name)}}function f(){window.location.reload()}document.addEventListener("DOMContentLoaded",(()=>{}));let h;const p=new Map,b=new Map,m=new Map,v=function(){const t=e("CONF");return"string"==typeof t?JSON.parse(t):null}(),y={},w=(void 0===h&&(h=e("_Host-bloqs-auth")),h);function g(e,t,n){if(null===v)throw new Error;const r=e.get(t);if(void 0!==r)return r;{const r=u(`${v.REST.domain}/${n}/${t}`,{headers:y}).then((async e=>{if(!e.ok)throw console.error(`[${e.status}]\t${await e.text()}`),new Error(await e.text()??"");return e.json()}));return e.set(t,r),r}}null!==w&&(y.Authorization=`Bearer ${w}`);const[,...x]=window.location.pathname.split("/");if("bloq"===x?.[0])if("make"===x?.[1])document.addEventListener("DOMContentLoaded",(()=>{n()}));document.addEventListener("DOMContentLoaded",(()=>{!function(){const e=document.getElementById("instance-asker");e instanceof HTMLDialogElement&&(e.addEventListener("close",(()=>{e.showModal(),e.addEventListener("close",f),e.addEventListener("cancel",f)}),{once:!0}),e.close());const t=document.forms.namedItem("instance-asker");if(null===t)return;t.addEventListener("submit",(()=>{}));const n=t[l];if(!(n instanceof RadioNodeList))return;const r=n.item(0);r instanceof HTMLInputElement&&(r.addEventListener("blur",d),r.addEventListener("change",d),r.addEventListener("input",d),r.addEventListener("focus",(async()=>{})))}()})),document.addEventListener("DOMContentLoaded",(async()=>{const e=document.getElementById("bloq-template");if(null===e||!(e instanceof HTMLTemplateElement))return;const t=e.parentNode;if(null!==t)for await(const n of async function*(){if(null===v)return;const e=`${v.REST.domain}/bloq`,t=await u(e,{headers:y}).then((async e=>{if(!e.ok)throw console.error(`[${e.status}]\t${await e.text()}`),new Error(await e.text()??"");return e.json()}));for(const e of t){if("number"!=typeof e.id)continue;const t=p.get(e.id);if(void 0!==t){yield t;continue}const n=Promise.resolve({id:e.id,category:g(m,e.category,"preference"),creator:g(b,e.creator,"profile"),description:e.description,hasAdultConsideration:e.hasAdultConsideration,keywords:e.keywords,name:e.name,image:"https://picsum.photos/254.webp"});p.set(e.id,n),yield n}}()){const r=e.content.cloneNode(!0).querySelector(".bloq");if(null===r)return;t.appendChild(r);const o=r.querySelector(".image");null!==o&&(o.src=n.image);const s=r.querySelector(".name");null!==s&&(s.innerText=n.name);const i=r.querySelector(".price");null!==i&&(i.innerText="34");const a=r.querySelector(".c");null!==a&&n.category.then((e=>{a.innerText=e.name}));const u=r.querySelector(".untitle");null!==u&&(u.innerText=`[${n.keywords.length}]`);const c=r.querySelector(".nsfw");null!==c&&(n.hasAdultConsideration||c.remove());const l=r.querySelector(".a");null!==l&&n.creator.then((e=>{l.href=window.location.origin+"/profile/"+e.id,l.innerText=e.name}));const d=r.querySelector(".aggregaterating");null!==d&&(d.href=window.location.origin+"/bloq/index/"+n.id+"#reviews");const f=r.querySelector(".visit");null!==f&&(f.href=window.location.origin+"/bloq/index/"+n.id)}})),function(e,t,n={}){if(n.expires&&n["max-age"])throw new Error("can't use time and max-age at the same time");if(n.expires instanceof Date&&(n.expires=n.expires.toUTCString()),!Number.isInteger(n["max-age"]))throw new Error("invalid max-age");let r=`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;for(const e in n){const t=n[e];r+=`; ${e}`,void 0===t||t instanceof Date||!0===t||(r+=`=${encodeURIComponent(t)}`)}document.cookie=r}("JS",(!0).toString(),{"max-age":900})}();
//# sourceMappingURL=bundle.js.map
